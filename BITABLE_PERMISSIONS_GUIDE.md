# é£ä¹¦å¤šç»´è¡¨æ ¼æƒé™é…ç½®æŒ‡å— / Feishu Bitable Permissions Setup Guide

## ğŸš¨ é—®é¢˜è¯Šæ–­ / Problem Diagnosis

å¦‚æœæ‚¨é‡åˆ°403 Forbiddené”™è¯¯ï¼Œè¯´æ˜åº”ç”¨ç¼ºå°‘å¤šç»´è¡¨æ ¼çš„è®¿é—®æƒé™ã€‚

## ğŸ”§ è§£å†³æ–¹æ¡ˆ / Solutions

### æ­¥éª¤1: æ£€æŸ¥åº”ç”¨æƒé™èŒƒå›´ / Step 1: Check App Permissions

1. **ç™»å½•é£ä¹¦å¼€æ”¾å¹³å°**
   - è®¿é—®: https://open.feishu.cn/
   - è¿›å…¥æ‚¨çš„åº”ç”¨ç®¡ç†é¡µé¢

2. **æ·»åŠ å¤šç»´è¡¨æ ¼æƒé™**
   åœ¨"æƒé™ç®¡ç†"é¡µé¢æ·»åŠ ä»¥ä¸‹æƒé™ï¼š
   ```
   âœ… bitable:read    - å¤šç»´è¡¨æ ¼è¯»å–æƒé™
   âœ… bitable:write   - å¤šç»´è¡¨æ ¼å†™å…¥æƒé™  
   âœ… docx:read       - æ–‡æ¡£è¯»å–æƒé™
   ```

3. **æäº¤å®¡æ ¸**
   - æ·»åŠ æƒé™åéœ€è¦æäº¤å®¡æ ¸
   - ä¼ä¸šç‰ˆåº”ç”¨éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†

### æ­¥éª¤2: åº”ç”¨æˆæƒè®¿é—®å¤šç»´è¡¨æ ¼ / Step 2: Authorize App Access

1. **æ–¹å¼ä¸€ï¼šé€šè¿‡å¤šç»´è¡¨æ ¼è®¾ç½®**
   - æ‰“å¼€æ‚¨çš„å¤šç»´è¡¨æ ¼
   - ç‚¹å‡»å³ä¸Šè§’"..."èœå•
   - é€‰æ‹©"åº”ç”¨è®¾ç½®"æˆ–"APIç®¡ç†"  
   - æ·»åŠ æ‚¨çš„åº”ç”¨å¹¶æˆæƒ

2. **æ–¹å¼äºŒï¼šé€šè¿‡åº”ç”¨å®‰è£…**
   - åœ¨åº”ç”¨ç®¡ç†é¡µé¢ç”Ÿæˆå®‰è£…é“¾æ¥
   - è®¿é—®å®‰è£…é“¾æ¥å¹¶æˆæƒåº”ç”¨è®¿é—®å¤šç»´è¡¨æ ¼

### æ­¥éª¤3: éªŒè¯tokenæƒé™ / Step 3: Verify Token Permissions

1. **ä½¿ç”¨ç”¨æˆ·tokenè€Œétenant token**
   å¦‚æœç»§ç»­æœ‰æƒé™é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ç”¨æˆ·è®¿é—®ä»¤ç‰Œï¼š
   
   ```python
   # åœ¨ src/feishu/client.py ä¸­æ·»åŠ ç”¨æˆ·tokenæ”¯æŒ
   def get_user_access_token(self, user_code: str) -> str:
       """è·å–ç”¨æˆ·è®¿é—®ä»¤ç‰Œ"""
       url = f"{self.base_url}/authen/v1/access_token"
       # å®ç°ç”¨æˆ·OAuthæµç¨‹
   ```

2. **æ£€æŸ¥tokenèŒƒå›´**
   ç¡®ä¿è·å–çš„tokenåŒ…å«bitableç›¸å…³æƒé™

### æ­¥éª¤4: æµ‹è¯•æƒé™ / Step 4: Test Permissions

è¿è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•æƒé™ï¼š

```bash
# æµ‹è¯•è¯»å–æƒé™
python main.py inspect-bitable \
  --app-token "your_app_token" \
  --table-id "your_table_id"

# æµ‹è¯•å†™å…¥æƒé™  
python main.py test-bitable-update \
  --app-token "your_app_token" \
  --table-id "your_table_id" \
  --record-id "your_record_id" \
  --field-name "æµ‹è¯•å­—æ®µ" \
  --field-value "æµ‹è¯•å€¼"
```

## ğŸ” æƒé™æ’æŸ¥æ¸…å• / Permission Troubleshooting Checklist

- [ ] åº”ç”¨å·²æ·»åŠ `bitable:read`å’Œ`bitable:write`æƒé™
- [ ] æƒé™ç”³è¯·å·²é€šè¿‡å®¡æ ¸
- [ ] åº”ç”¨å·²è¢«æˆæƒè®¿é—®ç›®æ ‡å¤šç»´è¡¨æ ¼
- [ ] ä½¿ç”¨çš„tokenæœ‰æ•ˆä¸”åŒ…å«æ­£ç¡®æƒé™
- [ ] å¤šç»´è¡¨æ ¼å’Œè®°å½•IDæ­£ç¡®
- [ ] å­—æ®µåç§°å®Œå…¨åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰

## ğŸ†˜ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ / Common Errors and Solutions

### 403 Forbidden
**åŸå› **: ç¼ºå°‘æƒé™æˆ–æœªæˆæƒ
**è§£å†³**: æŒ‰ç…§ä¸Šè¿°æ­¥éª¤1-2é…ç½®æƒé™å’Œæˆæƒ

### 400 Bad Request  
**åŸå› **: è¯·æ±‚å‚æ•°é”™è¯¯
**è§£å†³**: æ£€æŸ¥app_tokenã€table_idã€record_idæ˜¯å¦æ­£ç¡®

### 404 Not Found
**åŸå› **: èµ„æºä¸å­˜åœ¨
**è§£å†³**: ç¡®è®¤å¤šç»´è¡¨æ ¼å’Œè®°å½•ç¡®å®å­˜åœ¨

### 500 Internal Server Error
**åŸå› **: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
**è§£å†³**: ç¨åé‡è¯•æˆ–è”ç³»é£ä¹¦æŠ€æœ¯æ”¯æŒ

## ğŸ“ è·å¾—å¸®åŠ© / Getting Help

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·ï¼š

1. **æ£€æŸ¥é£ä¹¦å¼€æ”¾å¹³å°æ–‡æ¡£**
   - https://open.feishu.cn/document/

2. **è”ç³»ç®¡ç†å‘˜**
   - è¯·æ‚¨çš„é£ä¹¦ç®¡ç†å‘˜ç¡®è®¤åº”ç”¨æƒé™

3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—**
   ```bash
   tail -f logs/app.log
   ```

4. **ä½¿ç”¨æµ‹è¯•ç¯å¢ƒ**
   - å…ˆåœ¨æµ‹è¯•åº”ç”¨å’Œæµ‹è¯•è¡¨æ ¼ä¸ŠéªŒè¯åŠŸèƒ½

## ğŸ” å®‰å…¨å»ºè®® / Security Recommendations

1. **æœ€å°æƒé™åŸåˆ™**
   - åªç”³è¯·å¿…è¦çš„æƒé™
   - å®šæœŸreviewæƒé™èŒƒå›´

2. **Tokenå®‰å…¨**
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç token
   - å®šæœŸè½®æ¢access token

3. **å®¡è®¡æ—¥å¿—**
   - å¯ç”¨åº”ç”¨è®¿é—®æ—¥å¿—
   - ç›‘æ§å¼‚å¸¸è®¿é—®è¡Œä¸º 